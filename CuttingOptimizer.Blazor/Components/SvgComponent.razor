@using CuttingOptimizer.AppLogic.Models;
@using CuttingOptimizer.Domain.Models;
@using System.Globalization;

@if(Svg.Groups != null && Svg.Groups.Exists(c=>c.ID == 1))
{
    <div class="mt-5 print-page-brake-after">
        <div>
            <PlateDetail Saw=@Saw Svg=@Svg Count="@Count"/>
        </div>

        <div>
@*            <h3>@Svg.ID (Rest: @AreaLossPercentage.ToString("P", CultureInfo.InvariantCulture))</h3>
*@            <svg viewBox="0 0 @Svg.ViewBox.Length @Svg.ViewBox.Width" style="width: @Width.ToString("0.00", CultureInfo.InvariantCulture)%;">

                    @foreach (Group group in Svg.Groups)
                    {
                        <g>
                            @if (group.Rectangle != null)
                            {
                                if(group.ID == 0)
                                {
                                    <rect class="rect-free-space" width="@group.Rectangle.Length" height="@group.Rectangle.Width" x="@group.Rectangle.X" y="@group.Rectangle.Y" />
                                }
                                else
                                {
                                    <rect width="@group.Rectangle.Length" height="@group.Rectangle.Width" x="@group.Rectangle.X" y="@group.Rectangle.Y" />
                                }

                                if(group.Rectangle.Label != null && !group.Rectangle.Label.ToString().Equals("0"))
                                {
                                    <text>
                                        <text x="@(group.X + Pos)" y="@(group.Y + Pos + 10)" font-family="Verdana" font-size="14" fill="blue">@group.Rectangle.Label</text>
                                    </text>
                                }
                            }
                        </g>
                    }
            </svg>
        </div>
    </div>
}
@code {
    [Parameter]
    public double Scale { get; set; }

    [Parameter]
    public Svg Svg { get; set; }

    [Parameter]
    public Saw Saw { get; set; }

    [Parameter]
    public int Count { get; set; }

    private double Width { get; set; }

    private int Pos
    {
        get { 
            return 10; 
        }
    }

    protected override void OnInitialized()
    {
        if (Svg.ViewBox.Length / (double)100 == Scale)
        {
            Width = 100;
        }
        else
        {
            Width = Svg.ViewBox.Length / (double)Scale;
        }
    }
}
